@(sources: List[Source], myForm: Form[SkeletonSource])

@import helper._
@import helper.twitterBootstrap._

@title = {
Add a new stream parser <small><a href="@routes.CtrlSource.add()"></a></small>
}

@streamParserGroup(field: Field, className: String = "", modifyStreamPath: Boolean = false) = {
<div class="twipsies well parser @className" parserId="@{field("parserId").value}">
	<a class="removeParser icon-trash pull-right" parserId="@{field("parserId").value}" delete='true'></a>
	@**
		@inputText(field("parserId"),   '_label -> "Parser Id", 'readonly -> "readonly", 'class -> "form-horizontal")	
	**@
		<input type="hidden" name="parserId" value='@field("parserId").value' >

	
	@if(modifyStreamPath){
		@inputText(field("vfilePath"), '_label -> "Stream path", 'class -> "form-horizontal")
	} else {
		@inputText(field("vfilePath"),  '_label -> "Stream path", 'readonly -> "readonly", 'class -> "form-horizontal")
	}
	@inputText(field("inputParser"),'_label -> "Input parser", 'class -> "form-horizontal")
	@inputText(field("inputType"),  '_label -> "Content type", '_value -> "application/json", 'class -> "form-horizontal")
</div>
}

@layout("Manage", session) {

    <!-- Docs nav
    ================================================== -->
    <div class="row">
      <div class="span2 bs-docs-sidebar">
			 
			@manage.navigationMenu(sources) 
			@**
			should pass theses parameters(sources, extStreams)
			**@
      </div>
      <div class="span9">
				<br \>

 	      <!--Body content-->
	      <!-- TODO: handle errors-->
	      @if(myForm.hasErrors) {
	      <div class="alert-message error">
		      <p><strong>Oops</strong> Please fix all errors</p>
	      </div>
	      }
  <h1>Configure '@myForm("label").value'</h1>

	@helper.form(action = routes.CtrlSource.modify(myForm("id").value.toLong), 'id -> "modify_source_form", 'class -> "form-horizontal") {
	      <fieldset>
		      <legend>Source parameters</legend>

				Post key (secret): <pre>@myForm("key").value</pre>

				<br />
      	@inputText(myForm("id"), '_label -> "Id", 'readonly -> "readonly", 'class -> "form-horizontal")
	      @inputText(
			    myForm("label"),
		      '_label -> "Label:",
 					'class -> "form-horizontal"
	      )
	      @inputText(
					myForm("pollingUrl"),
		      '_label -> "Polling URL:",
 					'class -> "form-horizontal"
	      )
	      @inputText(
			    myForm("pollingPeriod"),
		      '_label -> "Polling period:",
 					'class -> "form-horizontal"
	      )
				@*
	      @inputText(
		      myForm("pollingAuthenticationKey"),
		      '_label -> "Authentication key",
		      '_help -> "Enter authentication details if required by polled source",
 					'class -> "form-horizontal"
		      )
				*@
	      </fieldset>

				<br />
	      <fieldset>
		      <legend>Stream Parsers</legend>
		      <div id="parsers" sourceId="@myForm("id").value">

			      @repeat(myForm("streamParserWrapers"), min=0) { spw =>
			        @streamParserGroup(spw)
			      }

			      @**
			      * Keep an hidden block that will be used as template for Javascript copy code
			      **@

			      @streamParserGroup(
				      myForm("streamParserWrapers[x]"),
				      className = "parsers_template",
							modifyStreamPath = true
			      )
		      </div>
	      </fieldset>
	      <div class="actions">				      
					<a class="addParser btn btn-success">Add another stream parser</a>
		      <input type="submit" class="btn btn-primary" name="update" id="updateSource" value="Update">
		      <a href="@routes.CtrlSource.manage()" class="btn">Cancel</a>
	      </div>
  			<br />
				<a href="@routes.CtrlSource.delete(myForm("id").value.toLong)" class="btn btn-danger">Delete source</a>
  }
  <br />
@**
*	@helper.form(action = routes.CtrlSource.delete(myForm("id").value.toLong), 'id -> "delete_source_form") {
*		<input type="submit" class="btn btn-danger" name="delete" value="Delete source">
*	}
**@
	      <!-- end modify source-->
  <br /> <br />
  <br /> <br />

    </div>
  </div>
}
