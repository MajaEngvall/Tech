@(sources: List[Source], myForm: Form[SkeletonSource])

@import helper._
@import helper.twitterBootstrap._

@title = {
Add a new stream parser <small><a href="@routes.CtrlSource.add()"></a></small>
}

@streamParserGroupLabels(className: String = "") = {
<div class="row-fluid @className controls controls-row">
<label class="span4">Stream path</label>
<label class="span3">Parser (Regex or JSON path)</label>
<label class="span3">MIME type</label>
</div>
}

@streamParserGroup(field: Field, className: String = "", modifyStreamPath: Boolean = true, deleteParser: Boolean = false) = {
<div class="row-fluid parser controls controls-row @className" parserId="@{field("parserId").value}">
<input type="hidden" id="@field("parserId").id" name="@field("parserId").name" value="@field("parserId").value" readonly="readonly" size="0">
<input class="span4" type="text" id="@field("vfilePath").id" name="@field("vfilePath").name" value="@field("vfilePath").value" placeholder="Stream path" @if(!modifyStreamPath){ readonly="readonly" } else { placeholder="Stream path"}>
<input class="span3" type="text" id="@field("inputParser").id" name="@field("inputParser").name" value="@field("inputParser").value" placeholder="Input parser">
@*<input type="text" id="@field("inputType").id" name="@field("inputType").name" value="@field("inputType").value" placeholder="Input type">*@
  <select class="span3" id="@field("inputType").id" name="@field("inputType").name" selected="@field("inputType").value">
  	<option value=""></option>
		<option value="application/json" @if(field("inputType").value.toString.contains("json")){selected="selected"}>application/json</option>
    <option value="text/plain" @if(field("inputType").value.toString.contains("text")){ selected="selected" }>text/plain</option>
  </select>
	<i class="removeParser btn-icon icon-trash pull-right" delete="false" @if(deleteParser){parserId="@{field("parserId").value}"}else{parserId="-1"}></i>
</div>
}

@layout("Manage", session) {

    <!-- Docs nav
    ================================================== -->
    <div class="row">
      <div class="span2 bs-docs-sidebar">
			 
			@manage.navigationMenu(sources) 
			@**
			should pass theses parameters(sources, extStreams)
			**@
      </div>
      <div class="span9">
				<br \>

 	      <!--Body content-->
	      <!-- TODO: handle errors-->
	      @if(myForm.hasErrors) {
	      <div class="alert-message error">
		      <p><strong>Oops</strong> Please fix all errors</p>
	      </div>
	      }

  <h1>Adding source</h1>

	@helper.form(action = routes.CtrlSource.add()) {
	      <fieldset>
		      <legend>Source configuration</legend>
					<fieldset>
		      <legend>Source parameters</legend>
					<div class="row-fluid controls controls-row">
						<label class="span3">Label</label>
						<label class="span5">Source URL</label>
						<label class="span2">Poll period</label>
					</div>
					<div class="row-fluid controls controls-row">
						<input class="span3" type="text" id="@myForm("label").id" name="@myForm("label").name" value="@myForm("label").value" placeholder="Source label">
						<input class="span5" type="text" id="@myForm("pollingUrl").id" name="@myForm("pollingUrl").name" value="@myForm("pollingUrl").value" >
						<input class="span2" type="text" id="@myForm("pollingPeriod").id" name="@myForm("pollingPeriod").name" value="@myForm("pollingPeriod").value" placeholder="Polling period">
					</div>
	      </fieldset>
	      	@*
					@inputText(
		      	myForm("pollingAuthenticationKey"),
		      	'_label -> "Authentication key",
		      	'_help -> "Enter authentication details if required by polled source"
		     	)
					*@
	      </fieldset>

		    <input type="submit" name="poll" class="btn btn-primary" value="Poll URL">
	      <fieldset>
		      <legend>Stream Parsers</legend>
		      <div id="parsers">
						@streamParserGroupLabels()
			      @repeat(myForm("streamParserWrapers"), min = 1) { spw =>
			        @streamParserGroup(spw)
			      }

			      @**
			      * Keep an hidden block that will be used as template for Javascript copy code
			      **@
						<div class="parsers_template">
			      	@streamParserGroup( myForm("streamParserWrapers[x]"), className = "", modifyStreamPath=true, deleteParser=false )
			      </div>
			      <div class="manage">
				      <a class="addParser btn btn-success">Add another stream parser</a>
			      </div>

		      </div>

	      </fieldset>

  <br />
	      <div class="actions">
		      <input type="submit" name="add" class="btn btn-primary" id="addSource" value="Add Source">
		      <a href="@routes.CtrlSource.manage()" class="btn">Cancel</a>
	      </div>
  }

	      <!-- end add source-->
  <br />
  <br />

    </div>
  </div>


}
