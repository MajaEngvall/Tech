@(resources: List[Resource], myForm: Form[SkeletonResource], addNewResource: Boolean)

@import helper._
@import helper.twitterBootstrap._

@title = {
	@if(addNewResource) {
		Add a new resource <small><a href="@routes.CtrlResource.add()"></a></small>
	} else {
		Resource '@myForm("label").value'
	}
}
@keyUrl = { @sicsthSenseURL()@{routes.CtrlResource.postByKey(myForm("key").value)} }

@resourceFormAction = @{
	if(addNewResource) {
		routes.CtrlResource.add()	
	} else {
		routes.CtrlResource.modify(myForm("id").value.toLong)
	}
}
@resourceFormId = @{
	if(addNewResource) {
		"add_resource_form"	
	} else {
		"modify_resource_form"
	}
}

@numberOfParsers = @{myForm("streamParserWrapers").indexes().length}

@streamParserGroupLabels(hidden: Boolean, className: String = "") = {
<div class="@if(hidden){hidden} row-fluid @className controls controls-row streamParsersLabels">
<span class="span3" for="@{myForm("streamParserWrapers")("vfilePath").id}">Path</span>
<span class="span3" for="@{myForm("streamParserWrapers")("inputParser").id}">Parser (Regex/JSON path)</span>
<span class="span3" for="@{myForm("streamParserWrapers")("timeformat").id}">Date/Time format</span>
<span class="span2" for="@{myForm("streamParserWrapers")("inputType").id}">MIME type</span>
</div>
}

@streamParserGroup(field: Field, className: String = "", modifyStreamPath: Boolean = true, deleteParser: Boolean = false) = {
<div class="row-fluid parser controls controls-row @className" data-parserId="@{field("parserId").value}">
<input type="hidden" id="@field("parserId").id" name="@field("parserId").name" value="@field("parserId").value" readonly="readonly" size="0">
<input class="span3" type="text" required id="@field("vfilePath").id" name="@field("vfilePath").name" value="@field("vfilePath").value" @if(!modifyStreamPath){ readonly } else { placeholder="Stream path"}>
<input class="span3" type="text" id="@field("inputParser").id" name="@field("inputParser").name" value="@field("inputParser").value" placeholder="expression or /jsonnode/name">
<input class="span3" type="text" id="@field("timeformat").id" name="@field("timeformat").name" value="@field("timeformat").value" placeholder="fill in if posting timestamps">
  <select class="span2" id="@field("inputType").id" name="@field("inputType").name" selected="@field("inputType").value">
  	<option value=""></option>
		<option value="application/json" @if(field("inputType").value.toString.contains("json")){selected="selected"}>application/json</option>
    <option value="text/plain" @if(field("inputType").value.toString.contains("text")){ selected="selected" }>text/plain</option>
  </select>
	<i class="removeParser btn btn-danger pull-right" data-delete="false" @if(deleteParser){data-parserId="@{field("parserId").value}"}else{data-parserId="-1"}><span class="icon-trash icon-white"></span></i>
@*<input type="text" id="@field("inputType").id" name="@field("inputType").name" value="@field("inputType").value" placeholder="Input type">*@
</div>
}

@layout("Manage", session) {

    <!-- Docs nav
    ================================================== -->
    <div class="row-fluid">
      <div class="span2 bs-docs-sidebar">
			 
			@manage.navigationMenu(resources) 
			@**
			should pass theses parameters(resources, extStreams)
			**@
      </div>
      <div class="span9">
 	      <!--Body content-->
	      <!-- TODO: handle errors-->
	      @if(myForm.hasErrors) {
	      <div class="alert-message error">
		      <p><strong>Oops</strong> Please fix all errors</p>
	      </div>
	      }
	      
  <h1>@title</h1>
	@if(!addNewResource) {
		@interactWithResource(myForm("id").value.toLong, myForm("pollingUrl").value)
	}
	
	@helper.form(action = resourceFormAction, 'id -> resourceFormId) {
	      <fieldset>
		      <legend>Parameters</legend>
					<div class="row-fluid controls controls-row">
						<label class="span3" for="@myForm("label").id">Label</label>
						<label class="span7" for="@myForm("pollingUrl").id">Resource URL</label>
						<label class="span2" for="@myForm("pollingPeriod").id">Polling period (s)</label>
					</div>
					<div class="row-fluid controls controls-row">
						<input type="hidden" id="myForm("id").id" name="@myForm("id").name" value="@myForm("id").value" readonly="readonly" size="0">
						<input class="span3" type="text" required id="@myForm("label").id" name="@myForm("label").name" value="@myForm("label").value" placeholder="Resource label">
						<input class="span7" type="url" id="@myForm("pollingUrl").id" name="@myForm("pollingUrl").name" value="@myForm("pollingUrl").value" placeholder="Type an URL to enable interaction!">
						<input class="span2" type="number" id="@myForm("pollingPeriod").id" name="@myForm("pollingPeriod").name" value="@myForm("pollingPeriod").value" placeholder="0">
					</div>
			@if(!addNewResource) {
				<div class="row-fluid controls controls-row">
				<label class="span1" for="@{myForm("key").id}KeyURL">Key</label>
				<input class="span11" type="text" id="@{myForm("key").id}KeyURL" name="keyUrl" value="@keyUrl" readonly>
				</div>

	      </fieldset>
			} else {
				</fieldset>
		    <!-- NOT WORKING input type="submit" name="poll" class="btn btn-primary" value="Poll URL"-->
			}
	      <fieldset>
		      <legend>Parsers <span style="float: right;"><a class="addParser btn btn-success"><span class="icon-plus icon-white"></span></a></span></legend>
		      <div id="parsers" resourceId="@myForm("id").value">
						
						@streamParserGroupLabels(numberOfParsers <= 0)
			      @repeat(myForm("streamParserWrapers"), min=0) { spw =>
			        @streamParserGroup(spw, className="", modifyStreamPath=addNewResource, deleteParser= !addNewResource)
			      }
						
			      @**
			      * Keep an hidden block that will be used as template for Javascript copy code
			      **@
						<div class="parsers_template">
			      	@streamParserGroup( myForm("streamParserWrapers[x]"), className = "", modifyStreamPath=true, deleteParser=false )
			      </div>
		      </div>
	      </fieldset>
				<br />

	      <div class="actions">				      
				@if(!addNewResource) {
		      <input type="submit" name="update" class="btn btn-primary" id="updateResource" value="Save changes"> &nbsp;
				} else {
		      <input type="submit" name="add" class="btn btn-primary" id="addResource" value="Add Resource"> &nbsp;
				}
				<a href="@routes.CtrlResource.resources()" class="btn">Cancel</a>
				@if(!addNewResource) {
					<a href="@routes.CtrlResource.delete(myForm("id").value.toLong)" class="btn btn-danger pull-right">Delete resource</a> &nbsp;
				}
	      </div>
	     @if(!addNewResource) {
  			<br /><br />
				@logViewPage(ResourceLog.getByResource(Resource.get(myForm("id").value.toLong, Secured.getCurrentUser()), false),"Log of last post")
				@logViewPage(ResourceLog.getByResource(Resource.get(myForm("id").value.toLong, Secured.getCurrentUser()), true),"Log of last poll")
			}
  }
	<!-- end modify resource-->
  </div>
</div>

}
